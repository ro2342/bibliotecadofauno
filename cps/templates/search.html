{% import 'image.html' as image %}
{% extends "layout.html" %}
{% block body %}
<div class="max-w-7xl mx-auto py-6">
    <div class="mb-10 b-8 border-b border-black/5 pb-8">
        {% if entries|length < 1 %}
            <h1 class="font-display text-4xl text-[var(--ink-primary)]">{{_('No Results Found')}}</h1>
            <p class="text-neutral-500 mt-2">{{_('Search Term:')}} <span class="font-bold text-[hsl(var(--md-sys-color-primary))]">{{adv_searchterm}}</span></p>
        {% else %}
            <h1 class="font-display text-4xl text-[var(--ink-primary)]">{{result_count}} {{_('Results for:')}} <span class="text-[hsl(var(--md-sys-color-primary))]">{{adv_searchterm}}</span></h1>
            
            <div class="flex flex-wrap items-center gap-4 mt-6">
                {% if current_user.is_authenticated and (current_user.shelf.all() or g.shelves_access) %}
                <div class="relative group">
                    <button class="flex items-center gap-2 bg-white/40 backdrop-blur-md border border-white/20 px-4 py-2 rounded-xl font-bold shadow-sm hover:bg-white/60 transition-all text-sm">
                        <span class="material-symbols-outlined !text-sm">format_list_bulleted_add</span>
                        {{ _('Add results to shelf') }}
                    </button>
                    <div class="absolute left-0 mt-2 w-64 bg-white/90 backdrop-blur-xl rounded-2xl shadow-2xl border border-black/5 flex-col hidden group-hover:flex z-10 max-h-64 overflow-y-auto">
                        {% for shelf in g.shelves_access %}
                            {% if not shelf.is_public or current_user.role_edit_shelfs() %}
                            <a class="postAction px-4 py-3 hover:bg-[hsl(var(--md-sys-color-primary))] hover:text-white transition-colors first:rounded-t-2xl last:rounded-b-2xl text-sm" role="button" data-action="{{ url_for('shelf.search_to_shelf', shelf_id=shelf.id) }}">
                                {{shelf.name}}{% if shelf.is_public == 1 %} {{_('(Public)')}}{% endif %}
                            </a>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- SORTING CONTROLS -->
                <div class="flex bg-white/30 backdrop-blur-sm p-1 rounded-xl border border-white/40">
                    <a href="{{url_for('web.books_list', data=page, sort_param='new', query=query)}}" class="p-2 rounded-lg hover:bg-white/60 transition-all {{ 'text-[hsl(var(--md-sys-color-primary))]' if order == 'new' else 'text-neutral-400' }}" title="{{_('Newest first')}}">
                        <span class="material-symbols-outlined">schedule</span>
                    </a>
                    <a href="{{url_for('web.books_list', data=page, sort_param='abc', query=query)}}" class="p-2 rounded-lg hover:bg-white/60 transition-all {{ 'text-[hsl(var(--md-sys-color-primary))]' if order == 'abc' else 'text-neutral-400' }}" title="{{_('Alphabetical')}}">
                        <span class="material-symbols-outlined">sort_by_alpha</span>
                    </a>
                    <a href="{{url_for('web.books_list', data=page, sort_param='authaz', query=query)}}" class="p-2 rounded-lg hover:bg-white/60 transition-all {{ 'text-[hsl(var(--md-sys-color-primary))]' if order == 'authaz' else 'text-neutral-400' }}" title="{{_('Author A-Z')}}">
                        <span class="material-symbols-outlined">person</span>
                    </a>
                </div>
            </div>
        {% endif %}
    </div>

    <!-- BOOKS GRID -->
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-8">
        {% for entry in entries %}
        <div class="group session transition-all duration-300 transform hover:-translate-y-2">
            <div class="relative overflow-hidden mb-4 shadow-lg group-hover:shadow-2xl transition-all duration-500 rounded-2xl aspect-[2/3] bg-neutral-200">
                <a href="{{ url_for('web.show_book', book_id=entry.Books.id) }}" class="block w-full h-full" {% if simple==false %}data-toggle="modal" data-target="#bookDetailsModal" data-remote="false"{% endif %}>
                    {{ image.book_cover(entry.Books) }}
                    
                    <!-- STATUS BADGES -->
                    <div class="absolute top-3 right-3 flex flex-col gap-2 scale-90 group-hover:scale-100 transition-transform">
                        {% if entry[2] == True %}
                        <div class="bg-green-600/90 backdrop-blur-md text-white px-2 py-1 rounded-lg shadow-lg flex items-center gap-1 text-[10px] font-bold uppercase tracking-tighter">
                            <span class="material-symbols-outlined !text-[12px] FILL">check_circle</span>
                            Lido
                        </div>
                        {% endif %}
                    </div>

                    <!-- OVERLAY GRADIENT -->
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 flex items-end p-4">
                        <p class="text-white text-[10px] font-bold uppercase tracking-widest">{{entry.Books.authors[0].name if entry.Books.authors else 'Autor'}}</p>
                    </div>
                </a>
            </div>
            <div class="text-center sm:text-left">
                <a href="{{ url_for('web.show_book', book_id=entry.Books.id) }}" {% if simple==false %}data-toggle="modal" data-target="#bookDetailsModal" data-remote="false"{% endif %}>
                    <h3 title="{{entry.Books.title}}" class="font-display text-lg font-bold truncate leading-tight group-hover:text-[hsl(var(--md-sys-color-primary))] transition-colors">{{entry.Books.title}}</h3>
                </a>
                <div class="flex items-center justify-center sm:justify-start gap-2 mt-1">
                    <p class="text-[10px] text-neutral-500 uppercase tracking-widest font-bold">
                        {% if entry.Books.series %}
                            {{entry.Books.series[0].name}} #{{entry.Books.series_index|formatfloat(0)}}
                        {% else %}
                            {{entry.Books.authors[0].name if entry.Books.authors else 'Autor'}}
                        {% endif %}
                    </p>
                </div>
                {% if entry.Books.ratings.__len__() > 0 %}
                <div class="flex gap-0.5 text-amber-500 mt-2 text-[10px] justify-center sm:justify-start">
                    {% for number in range((entry.Books.ratings[0].rating/2)|int) %}
                        <span class="material-symbols-outlined !text-[14px] FILL">star</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
