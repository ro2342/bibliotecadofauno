{% import 'image.html' as image %}
{% extends "layout.html" %}
{% block body %}
<div class="max-w-7xl mx-auto py-6">
  <div class="mb-10 border-b border-black/5 pb-8">
      <div class="flex flex-wrap items-end justify-between gap-6">
          <div>
              <h1 class="font-display text-4xl text-[var(--ink-primary)]">{{title}}</h1>
              <div class="flex gap-4 mt-4">
                  {% if current_user.role_download() %}
                  <a href="{{ url_for('shelf.show_simpleshelf', shelf_id=shelf.id) }}" class="flex items-center gap-2 text-sm font-bold text-[hsl(var(--md-sys-color-primary))] hover:underline">
                      <span class="material-symbols-outlined !text-sm">download</span>
                      {{ _('Download') }}
                  </a>
                  {% endif %}
              </div>
          </div>
          
          {% if current_user.is_authenticated and ((current_user.role_edit_shelfs() and shelf.is_public) or not shelf.is_public) %}
          <div class="flex flex-wrap gap-2">
              <a href="{{ url_for('shelf.edit_shelf', shelf_id=shelf.id) }}" class="bg-white/40 border border-white/20 px-4 py-2 rounded-xl font-bold shadow-sm hover:bg-white/60 transition-all text-xs flex items-center gap-2">
                  <span class="material-symbols-outlined !text-sm">edit</span>
                  {{ _('Properties') }}
              </a>
              <a href="{{ url_for('shelf.order_shelf', shelf_id=shelf.id) }}" class="bg-white/40 border border-white/20 px-4 py-2 rounded-xl font-bold shadow-sm hover:bg-white/60 transition-all text-xs flex items-center gap-2">
                  <span class="material-symbols-outlined !text-sm">reorder</span>
                  {{ _('Arrange') }}
              </a>
              <div class="bg-red-50 text-red-600 px-4 py-2 rounded-xl font-bold hover:bg-red-100 transition-all text-xs cursor-pointer flex items-center gap-2" id="delete_shelf" data-action="{{url_for('shelf.delete_shelf', shelf_id=shelf.id)}}" data-value="{{ shelf.id }}">
                  <span class="material-symbols-outlined !text-sm">delete</span>
                  {{ _('Delete') }}
              </div>
          </div>
          {% endif %}
      </div>

      {% if entries.__len__() %}
      <div class="flex flex-wrap items-center gap-4 mt-8">
          <div class="bg-white/30 backdrop-blur-sm p-1 rounded-xl border border-white/40 flex">
              <a href="{{url_for('shelf.show_shelf', shelf_id=shelf.id, sort_param='new')}}" class="p-2 rounded-lg hover:bg-white/60 transition-all {{ 'text-[hsl(var(--md-sys-color-primary))]' if order == 'new' else 'text-neutral-400' }}" title="{{_('Newest')}}">
                  <span class="material-symbols-outlined">schedule</span>
              </a>
              <a href="{{url_for('shelf.show_shelf', shelf_id=shelf.id, sort_param='abc')}}" class="p-2 rounded-lg hover:bg-white/60 transition-all {{ 'text-[hsl(var(--md-sys-color-primary))]' if order == 'abc' else 'text-neutral-400' }}" title="{{_('A-Z')}}">
                  <span class="material-symbols-outlined">sort_by_alpha</span>
              </a>
              <a href="{{url_for('shelf.show_shelf', shelf_id=shelf.id, sort_param='shelfnew')}}" class="p-2 rounded-lg hover:bg-white/60 transition-all {{ 'text-[hsl(var(--md-sys-color-primary))]' if order == 'shelfnew' else 'text-neutral-400' }}" title="{{_('Added to shelf')}}">
                  <span class="material-symbols-outlined">auto_stories</span>
              </a>
          </div>
          <button id="toggle_order_shelf" data-view="shelf" class="text-xs font-bold uppercase tracking-widest text-neutral-400 hover:text-[hsl(var(--md-sys-color-primary))] transition-colors">
              {% if status == "on" %}{{_('Disable manual order')}}{% else %}{{_('Enable manual order')}}{% endif %}
          </button>
      </div>
      {% endif %}
  </div>

  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-8">
    {% for entry in entries %}
    <div class="group session transition-all duration-300 transform hover:-translate-y-2">
        <div class="relative card-expressive overflow-hidden mb-4 shadow-lg group-hover:shadow-2xl transition-shadow">
            <a href="{{ url_for('web.show_book', book_id=entry.Books.id) }}" class="block aspect-[2/3]" {% if simple==false %}data-toggle="modal" data-target="#bookDetailsModal" data-remote="false"{% endif %}>
                {{ image.book_cover(entry.Books) }}
                {% if entry[2] == True %}
                <div class="absolute top-2 right-2 bg-green-600 text-white p-1 rounded-full shadow-md flex items-center justify-center">
                    <span class="material-symbols-outlined !text-xs">check</span>
                </div>
                {% endif %}
            </a>
        </div>
        <div class="text-center sm:text-left">
            <a href="{{ url_for('web.show_book', book_id=entry.Books.id) }}" {% if simple==false %}data-toggle="modal" data-target="#bookDetailsModal" data-remote="false"{% endif %}>
                <h3 title="{{entry.Books.title}}" class="font-display text-lg font-bold truncate leading-tight">{{entry.Books.title}}</h3>
            </a>
            <p class="text-xs text-neutral-500 truncate mt-1">
                {% for author in entry.Books.authors %}
                    {{author.name.replace('|',',')}}{% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
            {% if entry.Books.ratings.__len__() > 0 %}
            <div class="flex gap-0.5 text-amber-500 mt-2 text-[10px] justify-center sm:justify-start">
                {% for number in range((entry.Books.ratings[0].rating/2)|int(2)) %}
                    <span class="material-symbols-outlined !text-[12px] FILL">star</span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
{% block modal %}
{{ delete_confirm_modal() }}
{% endblock %}
